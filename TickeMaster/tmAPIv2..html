<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>TicketMasterApi Test</title>
</head>

<body>

    <div class="events"></div>

    <div id="test">
        <p>Hola!!!</p>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.19.2/moment.min.js"></script>
    <script type="text/javascript">
        /*global moment */
        var queryUrl = "https://app.ticketmaster.com/discovery/v2/events.json?stateCode=NC&city=Charlotte&startDateTime=";

        // Full url https://app.ticketmaster.com/discovery/v2/events.json?stateCode=NC&city=Charlotte&startDateTime=2017-11-17T11:10:44Z&endDateTime=2017-11-22T23:59:59Z&apikey=EFiXWPVDdZn0nrmHIv2uXTP3lnMO619H

        // yMD is the paramater that will be entered after startDateTime in the URL
        var yMd = moment().format("YYYY-MM-DD");
        //This will be broken up by the letter T
        var timeNow = moment().format("HH:mm:ss");
        //This will be followd by the letter Z
        // console.log(timeNow)
        var endTime = "&endDateTime=";
        var futureYmD = moment().add(3, 'days').format('YYYY-MM-DD');
        // followed by the letter T
        var timeThen = moment().add(3, 'days').format('HH:mm:ss');
        //followed by the letter Z
        var apiKey = "&apikey=EFiXWPVDdZn0nrmHIv2uXTP3lnMO619H";


        var fullApiKey = queryUrl + yMd + "T" + timeNow + "Z" + endTime + futureYmD + "T" + timeThen + "Z" + apiKey;
        console.log(fullApiKey)

        //I would like to make the above code an object but I'm super happy the api key works as intended.
        //It pulls the now time through 3 days late and puts it in the the api key.
        //the fix was breaking down the concantenation and I figured out that what was missing was the
        //& and = signs that I put on the variable endTime.  Life is great.
        //Next step is to create the click function that will go on the calendar.
        // I have to decide how the calender will work. An alternative is to make the click function
        // "listen" to the buttons that will be on the page.


        $.ajax({
                //crossDomain: true,
                type: "GET",
                url: fullApiKey,
                //url: "https://app.ticketmaster.com/discovery/v2/events.json?stateCode=NC&city=Charlotte&startDateTime=2017-12-09T14:00:00Z&endDateTime=2017-12-15T23:59:00Z&apikey=EFiXWPVDdZn0nrmHIv2uXTP3lnMO619H",
                async: true,
                dataType: "json",
                //cocontentType: "application/x-www-form-urlencoded; charset=utf-8",  was added to make sure that
                // ticketmaster was reading the characters like colon : as a character and not percent% or something random.
                contentType: "application/x-www-form-urlencoded; charset=utf-8",
                success: function(json) {
                    console.log("logging json");
                    console.log(json);
                    var evts = json._embedded.events;
                    for (i = 0; i < evts.length; i++) {
                        console.log(evts[i])
                    }
                    // Parse the response.
                    // Do other things.
                },
                error: function(xhr, status, err) {
                    console.log(xhr);
                    // This time, we do not end up here!
                }
            })


            // .done(function(response) {
                        //     $("#test").innerHtml = JSON.stringify(response);
                        // });
        //     console.log("logging response");
        //     console.log(response);
        // var newEvents = response.
        // })
    </script>
</body>

</html>
